# 	华为复习





# 第一章 网络通信基础

***

## 常见术语

***

尾部： 组装报文的时候，在数据载荷后面添加的信息。

***注意：***只有数据链路层有，其他层都是首部。



## OSI模型

***

物理层：比特流

数据链路层：数据帧

网络层：数据包、分组

传输层：数据段（TCP段，UDP报文）

（会话层、表示层）

应用层：报文





## TCP/IP协议簇

***

网络接入层（对应 物理层、数据链路层）

网际互联层（对应网络层）

传输层（对应传输层）

应用层（应用层，会话层，表示层）





## 网络类型

***

区域网—–局域网（10KM以内）——城域网——-广域网（几十、几百甚至一千公里）

网络拓扑：星型、总线型、环型、树型、全网状、部分网状，树型

三类、五类、超五类UTP最大传输距离  100M。

单工通信：只能收。

半双工：同一时间只能接或收

全双工：可以同时接、收。



# 第二章VRP基本命令

***

~~~
进入系统视图：
system-view

quti退到上一级

return直接退到用户视图

改设备的名字：
sysname +名字

配置某个端口地址，先进入该接口
interface +接口
然后：
IP address +IP地址  +子网掩码（可以用8，16，24，32代替）

连接ftp：
ftp  +ip地址
从ftp服务器上下载文件
get +文件名
上传文件：
put +文件名
~~~





## 保存当前配置

~~~
save +文件名+(后缀名：) .cfg / zip

自动保存
先 autosave interval on ，然后设置周期
autosave interval +时间（单位默认分钟）
~~~







# 第三章以太网

以太网最短有效帧长：64 byte。



## 以太网卡的功能模块

计算机上的网卡和交换机上的网卡功能模块一样。

CU ————控制单元

OB————输出缓存

IB————输入缓存

LC————线路编码器

LD————线路解码器

TX————发射器

RX————接收器

注意：线路编码器和解码器只具有数据链路层的功能。



网卡工作在***数据链路层和物理层***



作用： 用来进行数据的收发和转发。



## MAC：标识网卡的，48位

mac地址长度48bit（6个字节），前面三个字节是该制造商的OUI（厂商代码），后面三个字节是制造商自己分配（不同的网卡后面三个字节不同，且不能更改，只能被读取使用）。

BIA（固化地址）：厂商在网卡ROM中烧入的48位bit地址。也就是上面那个MAC。



## MAC分类

* 单播MAC地址：第一个字节最低位为0的
* 组播MAC地址：第一个字节最低位为1的
* 广播MAC地址：每个比特都是1的MAC地址。（是组播MAC地址的特例）





## 以太帧的格式



* 两个标准：
  * IEEE 802.3
  * Ethernet II 格式（DIX格式）





1. 目的MAC地址：6字节

2. 源MAC地址：6字节

3. 类型：2字节

4. 载荷数据：最短46字节，最长1500字节

5. 注意：因为最短有效帧长是64字节，减掉帧头（目的、源、类型共14字节）和帧尾4字节，还剩46字节。所以载荷数据的最短是46字节。



6. CRC（循环校验码）：4字节



7. 根据目的MAC地址的种类不同，以太帧又分为以下三种类型：

* 单播以太帧：目的MAC地址为一个单播MAC地址的帧
* 组播以太帧：目的MAC地址为一个组播MAC地址的帧
* 广播以太帧：目的MAC地址为一个广播MAC地址的帧

**注意**：广播地址可以做目的地址，不可做源地址！



## 以太网交换机

若交换机转发数据的端口都是以太网口，那么这样的交换机称为**以太网交换机**。



* 交换机具有学习能力，帧从一个端口进来，他就会检查这个帧的源MAC地址，然后把源MAC地址和进来的那个端口号映射在MAC地址表里面。 



### 三种转发

交换机对于传输介质进入某一端口的帧的转发操作。

* 洪泛：除进来的端口，通过其余的端口转发出去
* 转发：一个转发给另一个
* 丢弃：就是丢弃，再者说，就是不进行转发。



每台交换机都有一MAC地址表，存放MAC地址跟交换机端口之间的映射关系。刚开始上电时，是空的。通过不断学习转发，MAC地址表才会丰富起来。



***过程***：

* 进入的是单播帧，在MAC地址表里面查，查到就先比较这个MAC地址在表中对应的端口号是不是这个帧从传输介质进入交换机的那个端口号；（简单来说，就是比较是不是找到的那个端口是不是还是进来的那个端口。你不能从同一端口进来然后又转发出去吧。）

  * 如果不是，就进行转发
  * 如果是，就丢弃

  没有就进行洪泛。

* 进入的是广播帧，不用查表，直接进行洪泛。

* 进入的是组播帧，省略不讲。







### MAC地址表

* 交换机具有学习能力，帧从一个端口进来，他就会检查这个帧的源MAC地址，然后把源MAC地址和进来的那个（交换机的）端口号映射在MAC地址表里面。



老化机制：

1. 帧从端口进入交换机的时候，如果表中没有，就建立一条新的表项，设置倒数计时器为==300s==；（5min）

   如果表中已经有了，那就重置倒数计时器300s。

2. 当表中计数器的值变为==0==的时候，就立即删除这个表现。



注意：计数器的值越小，说明MAC地址表的动态性就越强。计算机中**没有**MAC地址表，只有ARP缓存表。

低档交换机可存放数千条表项；

中档交换机可存放数万条表项；

高档交换机可存放几十万条表项。



## ARP地址解析协议

* 是一个网络层的协议，但涉及到一些数据链路层的信息。

* **作用**： 根据已知的IP地址解析成对应的MAC地址。



* 过程：ARP 缓存表也具有动态性，跟上面MAC地址表一样，，只不过他的条目生存期是==180s==。

* ARP报文段中的op长度为2字节，表示ARP报文的**类型**，取值为**1** *是ARP*请求*报文，取值为*2*，是*应答报文*。

* ARP的类型字段占2 字节。值**0x0806.**
  
* 注意：0x0800是 ipv4，0x8006是ipv6.
  
* 携带ARP请求报文的帧是一个广播帧！

* 携带ARP应答报文的帧是一个单播帧。

* ARP缓存表存放位置：

  ARP的缓存表是***存储在网络设备或者计算机的内存中的***。

  在以太局域网内数据包传输依靠的是MAC地址，IP地址与MAC对应的关系依靠ARP表，每台安装有TCP/IP协议的主机(包括网关)都有一个ARP缓存表。该表中保存这网络中各个电脑的IP地址和MAC地址的对照关系。
  对于路由器等硬件系统，因其也需要转发，因此它也需要存储ARP缓存表，而这类小型网络设备使用的是嵌入式系统，其ARP缓存表会存在于它自己系统中的**RAM**里。由于系统结构的不同，有可能使用专业的RAM芯片，也有可能是CPU内置的RAM。























# ★第四章生成树（STP） 协议

* 是==由交换机运行==的、用来解决交换网络中环路问题的**数据链路层协议。**
* STP协议帧是组播帧
* 桥 = 交换机。
* PID不影响选举根桥.因为根桥是看BID.
* 根桥上端口是指定端口（有多个）
* 非根桥上端口是根端口（只有一个）
* 备用端口*（网段有多个路径时）*



## 原理过程

>
>
>~~~
>1.原理： 把一个具有物理环路的交换网络，交换机通过运行STP协议，自动生成一个没有环路的拓扑。
>
>一颗STP树包含唯一的一个根节点，任何一个结点到根节点的路径不仅是唯一的而且是最优的。当网络发生变化时，STP也会发生相应的变化。
>
>过程：
>选举根桥-----确定根端口和指定端口------最后阻塞备用端口
>
>网桥协议数据单元（BPDU）：运行在交换机上的STP协议帧，注意他不是网络层的数据单元。因为他的产生者、接收者、处理者都是交换机。
>每隔2s发送。
>刚开始所有交换机都发送BPDU，当STP稳定后，只有根桥才会发送。！！！！
>
>
>~~~
>
>1. 选举根桥： 首先都默认自己是根桥，当交换机从网络中获取到其他设备发送过来的BPDU时，比较接收到的BPDU中BID（桥ID）和自己的BID，然后不断交换，选出==BID最小的==交换机作为根桥。
>
>   BID（桥ID）由桥优先级和桥MAC地址组成。
>
>2. 确定根端口：
>
>  其余没有称为根桥的交换机都是非根桥。根端口都是在非根桥上。并且一台非根桥上根端口只有一个！
>
>  根路径开销（RPC）：端口转发速率越快，根路径开销就越小。
>
>  当RPC相同时，会比较上行设备的BID，如果BID相同，在比较上行设备的PID（端口ID）较小的作为根端口；如果不同，上行设备BID较小的作为根端口。、
>
>​		PID（端口ID）端口优先级和端口编号
>
>  （都是选小的）
>
>  
>
>  3. 指定端口;
>
>  一个网段有两条路径通往根桥。
>
>  流程：
>
>  RPC相同—–比较BID（大的作为备用端口，小的作为指定端口）—–相等，比较PID（大的作为备用端口，小的作为指定端口）
>
>  除根端口和指定端口之外的端口都是备用端口，交换机会对其进行阻塞。
>
>  根端口和指定端口：接收，发送，转发用户数据帧。
>
>  备用端口： 可接收处理，不能转发。
>
>  



**注意**：生成STP协议时机;

1. 拓扑刚搭成时
2. 拓扑发生变化时



## 报文格式

IEEE802.3

1. 网桥协议数据单元（BPDU）：运行在交换机上的STP协议帧，注意他不是网络层的数据单元。因为他的产生者、接收者、处理者都是交换机。
   每隔2s发送。
   刚开始所有交换机都发送BPDU，当STP稳定后，只有根桥才会发送。！！！！

2. message age ：BPDU每经过一个桥，这个值加 **1**。如果是从根桥发送的，值为0.

3. max  age： 最大生命周期， ==20s==

4. BPDU type： 0x00 ——configuration BPDU

   ​						0x80——TCN    BPDU

5. flags：网络拓扑变化标志。仅用最低为和最高位！

   最低为——TC标志(Topology Change拓扑改变)

   最高位—–TCA标志(Topology Change Acknowledgement拓扑改变确认)

6. Hello Time：==2s==

7. TCN BPDU：

   网络中链路发生损坏时，位于故障点的交换机会不断向上行设备以Hello Time为周期发送TCN BPDU ,直到接收到上游设备发来的TCA标志为1的 configuration BPDU 。上游交换机收到TCN BPDU后，一边通过指定端口回复TCA 标志置1 的BPDU，另一边以Hello Time为周期不断向上游发送TCN BPDU，。一直重复，直到根桥接收到TCN　BPDU，然后根桥发送TC标志置１的configuration　BPDU，通告所有交换机网络拓扑发生变化。这个时候，交换机MAC地址表的老化周期３００ｓ缩短为==15s==，加速老化。



## STP端口状态

1. 三种端口角色：

   1. 根端口、
   2. 指定端口、
   3. 备用端口

2. 五种端口状态

   1. 去能状态（Disabled）

      端口处于关闭状态。无法发送和接收

   2. 阻塞状态（Blocking）

      只能接收STP协议帧。

   3. 侦听状态（Listening）

      可以接收和发送STP协议帧

   4. 学习状态（Leaning）

      接收、发送STP协议帧，也可以进行MAC地址表学习！

   5. 转发状态（Forwarding）

      接收、发送STP协议帧，MAC地址表学习，还可转发用户数据帧。

      

      Forward　Delay：　１５ｓ。



## 快速生成树协议(RSTP)

STP收敛时间长,一般需要几十秒.

RSTP只需要几秒.



### RSTP端口状态

1. Discard ing

   不能转发用户数据帧和学习MAC地址表.

2. Learning

   不能转发数据帧,可以学习MAC地址表

3. Forwarding

   可以转发和学习.







## 命令

~~~
配置交换机上生成树的工作模式：
stp mode +mstp/rstp/stp

配置设备的桥优先级：
stp priority +数字（0-61440，步长4096，0、4096、8192）
值越小，优先级越高

指定某个设备称为根桥：
stp  root primary

备份根桥：
stp root secondary
~~~









# ★第五章虚拟局域网（VLAN）

* VLAN技术：  通过在**交换机**上部署VLAN机制，可以将一个大的广播域在逻辑上划分成若干个不同的、规模较小的广播域。可以减少垃圾流量和网络资源，提高网络安全。

* 广播域就是说如果站点发出一个广播信号后能接收到这个信号的范围。通常来说一个局域网就是一个广播域。

* [冲突域](https://baike.baidu.com/item/冲突域)：一个站点向另一个站点发出信号。除目的站点外，有多少站点能收到这个信号。这些站点就构成一个[冲突域](https://baike.baidu.com/item/冲突域)。

* [冲突域](https://baike.baidu.com/item/冲突域)是基于第一层（[物理层](https://baike.baidu.com/item/物理层)）

  广播域是基于第二层（[链路层](https://baike.baidu.com/item/链路层)）

  > 三层通信：
  >
  > ​		 目的MAC地址和源MAC地址**发生了变化，**，也就是源计算机发送的帧经过了路由器（或者其他具有三层转发功能的交换机），那么目的计算机接收到的帧**一定**不是源计算机发送的那个帧。
  >
  > 二层通信：
  >
  > ​		目的MAC地址和源MAC地址没有发生变化。

  

  > 二层网络和三层网络区别

  1、二层网络仅仅通过MAC寻址即可实现通讯，三层网络需要通过IP路由实现跨网段的通讯，可以跨多个冲突域。

  

  2、二层网络的组网能力非常有限，一般是小局域网；三层网络则可以组大型的网络。

  

  3、二层网络基本上是一个安全域，也就是说在同一个二层网络内，终端的安全性从网络上来讲基本上是一样的，除非有其他特殊的安全措施；三层网络则可以划分出相对独立的多个安全域。

    

  4、很多技术相对是在二层局域网中用的多，比如DHCP、windows提供的共享连接等，如需在三层网络上使用，则需要考虑其他设备的支持（比如通过DHCP中继代理等）或通过其他的方式来实现。

    

  > 三层交换机和二层交换机：

  普通的交换机是二层交换机，二层交换机只识别MAC地址，不识别IP地址（IP地址由电脑负责转换），不能路由，所以叫二层交换机。

    

  三层交换机不但能识别MAC地址，还能把MAC地址中的IP地址识别出来，进行路由。



* 在交换机里面配置了VLAN，交换机知道，但是计算机没有VLAN的概念。所以，不会在计算机上进行任何VLAN的配置。
* 交换机收到帧之后，会从数据帧里面**识别到***包含VLAN编号的信息，从而判断这个帧属于哪一个VLAN。





## 802.1Q帧格式

> IEEE802.1D定义不支持VLAN特性的交换机标准。
>
> IEEE802.1Q定义**支持**VLAN特性的交换机标准，并且覆盖IEEE802.1D，兼容。
>
> 交换机接收到帧（从哪个端口进的）之后，会识别出这个帧属于哪一个VLAN。然后在这个帧的特定位置加上一个==Tag==标签。Tag明确表明这个帧属于哪一个VLAN。



~~~
TPID   2字节    取值为0x8100表明帧带Tag信息。否则是一个传统的、不带Tag的帧。

PRI		3bits	取值0--7.值越大优先级越高。用于当阻塞的时候，先发送优先级高的帧。

GFI		1bit	不讲。

VID		12bits	VLAN Identifier，VLAN编号。取值0--4095.注意0和4095是协议保留取值，所以有效的取值范围是1-4094.但是现实中，1是默认分配的，所以真实取值是2--4094.
~~~



**注意**：计算机不会产生并发送带Tag的帧。如果接收到了这个帧，他会丢弃。



## VLAN类型



1. 基于端口的VLAN（Port-based VLAN）

   也叫物理层VLAN或者一层VLAN。

   划分原则：将VLAN的编号配置映射到交换机的物理端口上。从哪个端口进入的帧就被划分到该端口所属的那个VLAN。

2. 基于MAC地址的VLAN（MAC-based VLAN）

   也叫二层VLAN。

   划分原则：　交换机内部建立并维护了一个MAC地址表和VLAN　ID的对应表　。交换机分析帧中的源MAC地址，然后查询对应表，根据对应关系，把帧划分到相应的VLAN中。

3. 基于协议的VLAN（Protocol-based　VLAN）

   三层通信。

   划分原则：交换机根据计算机发送的无标签（Untagged）帧中的帧类型字段的值来决定帧所属VLAN。

   0x0800——–IPv4

4. 总结： 基于端口的VLAN在实际的网络中引用最广。也就是一层VLAN。





## 链路类型和端口类型



1. Access 链路（Access Link）：**交换机和终端计算机直接相连的**。ACcess链路上交换机一侧的端口叫**Access口。**

   在这个链路上的帧都是不带标签的。所属VLAN只能是特定的一个。

   Access口只能属于某个VLAN。

2. Trunk 链路（Trunk Link）：交换机和交换机直接相连接的。Trunk链路上两侧的端口叫做**Trunk口。**

   这个链路上的帧都是带标签的，并且所属的VLAN可以是多个。

   Trunk口可以属于多个VLAN。

3. 每一个交换机的端口无论是Access口和Trunk口都需要配置PVID（Port VLAN ID）。如交换机的一个端口PVID是5，那么所有到达这个端口的帧都被认为属于VLAN5的。

   默认情况下，PVID值为*1*。

4. Hybrid口。

   Hybrid口除了需要配置PVID外，还需要一个Untagged VLAN ID表和一个Tagged VLAN ID表。这两个VLAN ID表中所有VLAN 的帧都允许通过Hybrid端口。

   工作过程：

   * 当Hybrid口从*链路上*收到一个Untagged帧，然后交换机会在这个帧中加上VID为PVID的tag，然后查看两个表Untagged VLAN ID、Tagged VLAN ID，如果在表中，就进行转发（点对点、洪泛），不在就直接丢弃。

     从链路上收到带Tagged帧的情况也是一样。

   * 当一个Tagged帧从本交换机的其他端口到达一个Hybrid口后，不在Tagged VLAN ID表，也不再Untagged VLAN ID，那就直接丢弃。

   * 当一个Tagged帧从本交换机的其他端口到达一个Hybrid端口后，如果在Untagged VLAN ID表中，那就对这个帧的**Tag*剥离，然后将得到的UnTagged帧转发出去。

   * 当一个Tagged帧从本交换机的其他端口到达一个Hybrid端口后，如果在Tagged VLAN ID表中，交换机不会剥离Tag，直接进行转发。
   
   * 总结：接收报文时：
        hybrid报文在收到数据的时候，先看它是否带VLAN标签和是否允许通过（在untagged和tagged列表中的都算允许通过，这个就相当于trunk的 allow-pass vlan），如图，当你给PC1划入vlan10的时候（port hybrid pvid vlan 10），相应的就要放行vlan10（port hybrid untagged vlan 10）。
        如果报文已经有标签且可以通过，则让报文带着标签通过；
        如果报文没标签且可以通过，则打上PVID，再让带着PVID标签的报文通过；（以上两点跟trunk端口一样）
        如果不在untagged或tagged列表，则表示不允许通过，丢弃此报文。
     发送报文时：
        如果报文在untagged或tagged列表，则表示可以从此端口通过，
        对于untagged列表中的报文，在发送的时候去掉vlan标签后再从端口发送出去；
        对于tagged列表中的报文，在发送的时候带着vlan标签从端口发送出去。
        如果报文不在untagged或tagged列表，表示不从此端口通过。





## 端口和VLAN配置命令

配置交换机端口的类型和所属的VLAN

~~~
创建VLAN
vlan 10（这个数字随便取）

把端口划分到vlan中，想进入端口试图，然后设置端口类型。（端口默认是Hybrid 口）
interface GE0/0/0
port link-type access
port default vlan 10（access口的写法）

interface GE0/0/1
port link-type trunk
port trunk allow-pass vlan 10（trunk口）


~~~





## GVRP

对交换机进行VLAN配置时，如果数量过多会很耗时间。IEEE制定一个通用属性注册协议（GARP）的框架协议。

* 包括GMRP和GVRP。
* 手工配置的VLAN叫做静态VLAN；交换机通过GVRP协议自动创建的VLAN叫做动态VLAN。
* VLAN属性的动态注册过程和动态注销过程都是单向的。
* 过程见书P119.
* <img src="D:\Picture\Typora\华为网络\GVRP动态注册过程.png" style="zoom: 200%;" />





## GVRP 配置命令

~~~
现在全局配置GVRP
【S1】grvp

全局配置好GRVP之后，在对具体的端口进行配置
Access口的
【S1】interface GE0/0/0
【S1-GE0/0/0】gvrp
【S1-GE0/0/0】port  link-type access
【S1-GE0/0/0】port default vlan 10
Trunk口一样，只不过VvLan命令不一样而已
【S1】interface GE0/0/1
【S1-GE0/0/1】gvrp
【S1-GE0/0/1】port  link-type trunk
【S1-GE0/0/1】port trunk allow-pass vlan 10
（注意：【S1】port trunk allow-pass vlan all这是允许所有的VLAN上的帧都通这个口）

~~~



***补充***：

* 目的主机不可达：

  路由表找不到这个地址

* 连接超时;

  能找到这个地址，但是可能该设备没有开机或者掉线等等。







# 第六章 IP基础

ipv4 和ipv6主要两个版本。



## 有类编址、无类编址、子网掩码、特殊IP

* IP长度32个比特，也就是4字节。

* 注意 ：与MAC地址一样，IP地址是网路设备接口的属性，而不是网络设备本身的属性。

* 有类编址限定了网络号和主机号的位数。

* 无类编址不限定网络奥和主机号的位数。采用无类编址的时候，我们用子网掩码去判定IP地址所属网络的网络号。

  具体:	用IP地址和子网掩码进行相与（&），得到的结果就是这个IP地址的所在网络地址。

* 子网掩码： 也是由32个比特组成。它本身不是一个IP地址，并且必须是**连续的0和1**组成。

* RIP工作在应用层。

  



有类编址：

1. A类;  0-127

2. B类：  128-191

3. C类：  192-223

4. D类：  224-239

5. E类;   240-255

6. 补充：

   网络地址：	如果一个网段为X，其主机号为**全0*，那么这个IP地址叫做这个网段的网络地址。

   广播地址：		如果一个网段为X，其主机号**为全1**，那么这个IP地址叫做这个网段的广播地址。



特殊IP：

1. 255.255.255.255： 有限广播地址

2. 0.0.0.0： 任何网络的网络地址

3. 127.0.0.0/8： 这部分地址叫做环回地址。

   作用：常用来测试设备本身的软件系统

4. 169.254.0.0/16： 如果一个网络设备获取IP地址的方式被设置成自动获取，但是该设备在网络中没有找到可用的DHCP服务器，那么该设备就会在169.254.0.0/16这个网段中用一个地址来进行临时通信。





## IP报文格式



![](D:\Picture\Typora\华为网络\IP报文格式.gif)

~~~
版本		4bit	0x4是ipv4 ；0x6是ipv6

包头部长度 		4bit（最长是64bit），长度不固定，但必须是4bit的整数。

IP 报头的最小长度为 20 字节，上图中每个字段的含义如下：
1) 版本（version）
占 4 位，表示 IP 协议的版本。通信双方使用的 IP 协议版本必须一致。目前广泛使用的IP协议版本号为 4，即 IPv4。

2) 首部长度（网际报头长度IHL）
占 4 位，可表示的最大十进制数值是 15。这个字段所表示数的单位是 32 位字长（1 个 32 位字长是 4 字节）。因此，当 IP 的首部长度为 1111 时（即十进制的 15），首部长度就达到 60 字节。当 IP 分组的首部长度不是 4 字节的整数倍时，必须利用最后的填充字段加以填充。
数据部分永远在 4 字节的整数倍开始，这样在实现 IP 协议时较为方便。首部长度限制为 60 字节的缺点是，长度有时可能不够用，之所以限制长度为 60 字节，是希望用户尽量减少开销。最常用的首部长度就是 20 字节（即首部长度为 0101），这时不使用任何选项。

3) 区分服务（tos）
也被称为服务类型，占 8 位，用来获得更好的服务。这个字段在旧标准中叫做服务类型，但实际上一直没有被使用过。1998 年 IETF 把这个字段改名为区分服务（Differentiated Services，DS）。只有在使用区分服务时，这个字段才起作用。

4) 总长度（totlen）
首部和数据之和，单位为字节。总长度字段为 16 位，因此数据报的最大长度为 2^16-1=65535 字节。

5) 标识（identification）
用来标识数据报，占 16 位。IP 协议在存储器中维持一个计数器。每产生一个数据报，计数器就加 1，并将此值赋给标识字段。当数据报的长度超过网络的 MTU，而必须分片时，这个标识字段的值就被复制到所有的数据报的标识字段中。具有相同的标识字段值的分片报文会被重组成原来的数据报。

6) 标志（flag）
占 3 位。第一位未使用，其值为 0。第二位称为 DF（不分片），表示是否允许分片。取值为 0 时，表示允许分片；取值为 1 时，表示不允许分片。第三位称为 MF（更多分片），表示是否还有分片正在传输，设置为 0 时，表示没有更多分片需要发送，或数据报没有分片。

7) 片偏移（offsetfrag）
占 13 位。当报文被分片后，该字段标记该分片在原报文中的相对位置。片偏移以 8 个字节为偏移单位。所以，除了最后一个分片，其他分片的偏移值都是 8 字节（64 位）的整数倍。

8) 生存时间（TTL）
表示数据报在网络中的寿命，占 8 位。该字段由发出数据报的源主机设置。其目的是防止无法交付的数据报无限制地在网络中传输，从而消耗网络资源。
路由器在转发数据报之前，先把 TTL 值减 1。若 TTL 值减少到 0，则丢弃这个数据报，不再转发。因此，TTL 指明数据报在网络中最多可经过多少个路由器。TTL 的最大数值为 255。若把 TTL 的初始值设为 1，则表示这个数据报只能在本局域网中传送。 

9) 协议
表示该数据报文所携带的数据所使用的协议类型，占 8 位bit。该字段可以方便目的主机的 IP 层知道按照什么协议来处理数据部分。不同的协议有专门不同的协议号。
例如，TCP 的协议号为 0x06，
UDP 的协议号为0x11，
ICMP 的协议号为0x01
IGMP    0x02
OSPF    0x59


10) 首部检验和（checksum）
用于校验数据报的首部，占 16 位。数据报每经过一个路由器，首部的字段都可能发生变化（如TTL），所以需要重新校验。而数据部分不发生变化，所以不用重新生成校验值。

11) 源地址
表示数据报的源 IP 地址，占 32 位。

12) 目的地址
表示数据报的目的 IP 地址，占 32 位。该字段用于校验发送是否正确。

13) 可选字段
该字段用于一些可选的报头设置，主要用于测试、调试和安全的目的。这些选项包括严格源路由（数据报必须经过指定的路由）、网际时间戳（经过每个路由器时的时间戳记录）和安全限制。

14) 填充
由于可选字段中的长度不是固定的，使用若干个 0 填充该字段，可以保证整个报头的长度是 32 位的整数倍。

15) 数据部分
表示传输层的数据，如保存 TCP、UDP、ICMP 或 IGMP 的数据。数据部分的长度不固定。
~~~





## 子网划分，求广播地址和网络地址

***

一个主机的IP地址是202.112.14.137，掩码是255.255.255.224，要求计算这个主机所在网络的网络地址和广播地址？





### 根据子网掩码可以分割网络号+主机号

------

`255.255.255.224` 转二进制：

> 11111111 11111111 11111111 11100000

网络号有27位，主机号有5位

网络地址就是：把IP地址转成二进制和子网掩码进行与运算

11001010 01110000 00001110 10001001

==网络地址=IP地址&子网掩码==

```c
IP ：   11001010 01110000 00001110 10001001
子网：   11111111 11111111 11111111 11100000
------------------------------------------------------
        11001010 01110000 00001110 10000000
```

- 1
- 2
- 3
- 4
- 5
- 6
- 7

即：202.112.14.128



### 计算广播地址

------

广播地址：子网掩码0的地方**主机位全部变成1** ，（原来子网是11100000，后面5个0是主机号，全改为1，计算出值，计算出来的值加上原来的网络地址就是这个网络的广播地址。）10011111 即159 即：

​	202.112.14.159







## 根据每个网络的主机数量进行子网地址的规划和计算子网掩码

------

这也可按上述原则进行计算。

比如一个子网有10台主机，那么对于这个子网需要的IP地址是 
10＋1＋1＋1＝13 
**注意**：加的第一个1是指这个网络连接时所需的==网关地址==，接着的两个1分别是指==网络地址==和==广播地址==。 
因为13小于16（16等于2的4次方），所以主机位为4位。

而 256－16＝240 所以该子网掩码为255.255.255.240。

如果一个子网有14台主机，不少人常犯的错误是：依然分配具有16个地址空间的子网，而忘记了给网关分配地址。这样就错误了，因为： 
14＋1＋1＋1＝17 
17.大于16，所以我们只能分配具有32个地址（32等于2的5次方）空间的子网。这时子网掩码为：255.255.255.224

5） 主机的数量





## 补充：不能用做外网地址的IP（私网）



![](D:\Picture\Typora\算法\私有网络-1616226178301.png)

1. 127.0.0.1 为保留地址，一般用于环回地址。②127.x.x.x是保留地址，用作循环测试用
2. 10.x.x.x——-10.255.255.255
3. 172.16.0.0—172.31.255.255是私有地址
4. ② 169.254.x.x是保留地址。如果IP地址是自动获取IP地址，而在网络上又没有找到可用的DHCP服务器，就会得到其中一个IP。
5. 192.168.0.0—223.255.255.254全部为内网（私有）地址
6. 

















# 第七章TCP/UDP

* 两个都是传输层的协议





## TCP会话的建立



通过三次握手建立联系。

三次握手就是交换3个TCP控制段：

1. SYN段（Synchronization），为1建立连接请求
2. SYN段+ACK段
3. ACK段（acknowledge），ack为1确认信息

准确：

第一次握手：客户端的应用进程主动打开，并向服务端发出请求报文段。其首部中：SYN=1,seq=x。
第二次握手：服务器应用进程被动打开。若同意客户端的请求，则发回确认报文，其首部中：SYN=1,ACK=1,ack=x+1,seq=y。
第三次握手：客户端收到确认报文之后，通知上层应用进程连接已建立，并向服务器发出确认报文，其首部：ACK=1,ack=y+1。当服务器收到客户端的确认报文之后，也通知其上层应用进程连接已建立。

![](D:\Picture\Typora\华为网络\TCP会话的建立.png)





## TCP会话的终止

通过四次挥手终止会话。

1. FIN
2. ACK
3. FIN（finish）
4. ACK

准确一点：

（1） TCP客户端发送一个FIN，用来关闭客户到服务器的数据传送。
（2） 服务器收到这个FIN，它发回一个ACK，确认序号为收到的序号加1。和SYN一样，一个FIN将占用一个序号。
（3） 服务器关闭客户端的连接，发送一个FIN给客户端。
（4） 客户端发回ACK报文确认，并将确认序号设置为收到序号加1。



<img src="D:\Picture\Typora\华为网络\TCP会话的终止.png" style="zoom:200%;" />





## 应用端口



* 知名端口： 0-1023  。专门给标准组织定义一些特定的应用层模块。
* 非知名端口： 1024–65535

~~~
20		FTP数据
21		FTP控制
23		telnet  
25		SMTP（简单邮件传输协议）
53		DNS（域名解析系统）
80		HTTP（超文本传输协议）
110		POP3（第三版邮局协议）
~~~













# ★第八章路由协议基础



## 路由的概念

* 路由表只存在终端计算机和路由器（三层交换机）中，二层交换机有MAC地址表，但不存在路由表！！！

* 路由信息三要素;

  1. 目的地 / 掩码
  2. 出接口
  3. 下一跳IP地址

* 路由总是根据**最优路由**来进行IP转发的。

* 路由信息的生成方式：

  1. 设备自动发现（**直连路由**）

  2. 手工配置（***静态路由***，一般有网络管理员来完成，需要配置到所有非直连的网络）

     弊端：拓扑结构发生变化路由器不知道，不具有适应性。

  3. 动态路由协议生成（**如RSPF，OSPF**）

     注意;	

     ​		一台路由器可以运行多种路由协议。

     ​		计算机不运行任何路由协议，计算机上只有一个IP路由表。所以计算机的IP路由表要么是直连路由，要么是手工配置的静态路由。。

     ​		路由器的IP路由表可以是直连路由，也可以是静态路由，大多是各种协议生成的动态路由。路由器上除了存在的IP路由表外（这个路由表只有一个）,还有各个路由协议创建和维护的路由表。

  

* 路由的优先级： 数值越小，优先级越高。
  * 直连路由——0
  * OSPF———10
  * 静态路由——–60
  * RIP———100
  * BGP———255

* 路由的开销：  RIP协议（路由信息协议，是一个内部网关协议）只能将***跳数***作为开销。

* 默认路由： 目的地 / 掩码 为0.0.0.0/0的。如果默认路由是路由协议产生的，就叫做*动态默认路由*；如果默认路由是手工配置的，就叫做*静态默认路由*。

* 计算机上的IP路由表规模很小，一般只有1，20条，出去方便。

  





## 路由配置命令



1. 静态路由

~~~
【R1】 ip route-static 2.0.0.0(目标地址) 8(子网掩码) 12.0.0.2(下一跳地址) GE 0/0/1

显示路由表
display ip routing table


~~~



2. 默认路由

   ~~~
   【R1】IP routing-static 0.0.0.0  0  12.0.0.1  GE 0/0/2
   ~~~



## 补充：路由器选取路由



==先看路由的优先级==，优先级高的就直接加入到路由表中，不管开销。

如果是同种协议，那么==在比较其开销值==，选取开销小的加入到路由表中。



## RIP路由信息                                                                                                                                                                                                                                                                                                     协议

路由信息协议

### 路由协议概述

分为两类：

1. 内部网关协议（IGP）

   1. RIP（路由信息协议,，基于UDP协议）
   2. OSPF（开放式最短路径优先，基于IP协议）
   3. IS-IS（）

2. 外部网关协议（EGP）

   1. BGP(边界网关协议，基于TCP协议)

   

   

### RIP基本原理

* *跳数*定义路径开销，当==等于大于16==视为不可达。
* 每台RIP路由器会每隔==30s==向他的所有邻居发布他最新的路由信息。



### RIP消息格式

* 两个版本;

  1. RIP-1

  2. RIP-2

     比较RIP1的**优势：**

     1. 支持无类路由，rip1只支持有类路由
     2. 支持认证功能
     3. 可以采用组播方式发布消息。

* 这里只关心RIP -1格式：

  1. 命令。		

     该字段长8bit ，取值为**1**时表示该消息是一个**请求消息**。

     取值为*2*，表示*响应*。

  2. 版本

     长度8bit，取值为1表示该消息是一个RIP-1消息。

     取值为2，表示RIP-2消息。

  3. 协议簇

     长度16bit，表示所使用的协议簇。对于TCP/IP，取值为2.

  4. 跳数

     长度32bit。Cost，最小值1，最大值16（网络不可达）。

     

* ***注意***：RIP-1不能携带子网掩码 ，RIP-2可以。所以1只能适合有类编址实现有类路由，2支持无类路由。

  ​		一个RIP消息最多可以包含==25==条路由消息。





### RIP定时器

1. 更新定时器
   1. 周期值**30s**。为0时向周围邻居路由器发送RIP响应消息
2. 无效定时器
   1. 周期值**180s**。
   2. 通常情况下，一个路由项每隔**30s**就会更新。当无效定时器周期为0时，路由器会认为该路由项变为一个无效的路由项，Cost值立马置为**16**（该路由项所指的目的地不可达）.
3. 垃圾收集定时器
   1. 周期值*120s*。
   2. 无效定时器值倒计为0时，路由器不会立马将其删除，而是会启动垃圾收集定时器，这个值为0之前，该路由器 仍然会在RIP响应消息中携带这个无效路由，告诉邻居路由器、让他们各自的RIP路由表进行更新。但是当无效计时为0，这个路由项就会删除。



### RIP网络的路由环路问题

RIP提供三种解决方法

1. 触发更新

   因网络拓扑发生变化导致路由表发生改变时，路由器立刻产生更新通告直连邻居，**不在需要等待30秒**的更新周期，这样做是为了尽可能的将网络拓扑的改变通告给其他人。

2. 水平分割

   其规则就是不向原始路由更新来的方向再次发送路由更新信息（个人理解为单向更新，单向反馈）。比如有三台路由器ABC，B向C学习到访问网络10.4.0.0的路径以后，不再向C声明自己可以通过C访问10.4.0.0网络的路径信息，A向B学习到访问10.4.0.0网络路径信息后，也不再向B声明，而一旦网络 10.4.0.0发生故障无法访问，C会向A和B发送该网络不可达到的路由更新信息，但不会再学习A和B发送的能够到达10.4.0.0的错误信息。

3. 毒性逆转

   结合上面的例子，当路由器B看到到达网络10.4.0.0的度量值为无穷大的时候，就发送一个叫做毒化逆转的更新信息给C路由器，说明10.4.0.0这个网络不可达到，这是超越水平分割的一个特列，这样保证所有的路由器都接受到了毒化的路由信息。

4. 一台RIP路由器可以同时具有**触发更新和水平分割**的功能，或者同时具备**触发更新和毒性逆转功能。**





### RIP基本配置

~~~
输入rip即可（如果不带数值，默认为1）
【R1】rip
[R1-rip-1]

发布指定网段，配路由器周围的网段即可
[R1-rip-1]network 12.0.0.0

可以查看一下配置信息
[R1】display  rip
~~~







## 开放式最短路径优先协议（OSPF）

https://www.cnblogs.com/airoot/p/11271343.html讲解



### OSPF原理及配置

OSPF（Open Shortest Pass First,开放最短路径优先协议），是一个最常用的内部网管协议，是一个链路状态协议。





### OSPF的特点

1. OSPF是一种无类路由协议，支持VLSM可变长子网掩码。支持IPV4和IPV6.
2. 组播地址：224.0.0.5    224.0.0.6。
3. OSPF度量：从源到目的所有出接口的度量值，和接口带宽反比（10^8/带宽）。
4. 收敛速度极快，但大型网络配置很复杂。
5. IP封装，协议号89



### OSPF运行原理

OSPF组播的方式在所有开启OSPF的接口发送Hello包，用来确定是否有OSPF邻居，若发现了，则建立OSPF邻居关系，形成邻居表，之后互相发送LSA（链路状态通告）相互通告路由，形成LSDB（链路状态数据库）。再通过SPF算法，计算最佳路径（cost最小）后放入路由表。
设计要求：1.必须配置骨干区域（area 0）
         2.其他区域连接到骨干区域
好处: 1.减小路由表（通过域间汇总）
     2.本地拓扑变化值影响一个区域（也是通过汇总）
     3.某些LSA之子本地泛红，不泛洪到其他区域
注：OSPF区域划分基于接口而不是设备





### OSPF区域及路由器身份



### OSPF区域

**骨干区域（区域0）**：骨干区域必须连接所有的非骨干区域，而且骨干区域不可分割，**有且只有一个**，一般情况下，骨干区域内没有终端用户。
**非骨干区域（非0区域）**：非骨干区域一般根据实际情况而划分，必须连接到骨干区域（不规则区域也需通过tunnel或virtual-link连接到骨干区域）。一般情况下，非骨干区域主要连接*终端用户和资源。*





### 分区域管理

![](D:\Picture\Typora\华为网络\OSPF分区域管理.png)





### OSPF身份

**DR（Designated Router）**：指定路由器，OSPF协议启动后开始选举而来
**BDR（Back-up Designated Router）**：备份指定路由器，同样是由OSPF启动后选举而来
DRothers：其他路由器，非DR非BDR的路由器都是DRothers。

**ABR（Area Border Routers）**：区域边界路由器，连接不同OSPF区域。
**ASBR（Autonomous System Boundary Router）**：自治系统边界路由器，位于OSPF和非OSPF网络之间。
**骨干路由器**：至少有一个借口连接到骨干区域（区域0）。





### OSPF邻居建立

邻居的两个状态
Neighbors：邻居
Adjacency：邻接

1. 邻居不一定是邻接，邻接一定是邻居，只有交互了LSA的OSPF邻居才成为OSPF的邻接，之交互Hello包的支撑位邻居，
2. 在点对点网络中，所有邻居都能成为邻接。
3. MA（广播多路访问网络，比如以太网）网络类型中，DR，BDR，DRothers三者关系为：
   DR、BDR与所有的邻居形成邻接，DRothers之间只是邻居而不交换LSA
4. ==邻接关系数： n（n-1）/2==

影响OSPF邻居建立的原因：

1. Hello与Dead Time时间不一致（**改Hello的话Dead自动*4，单改Dead的话Hello不变）***
2. 区域ID必须一致
3. 认证（password一致）
4. Stub标识一致（与特殊区域有关，之后介绍）
5. MTU-携带在DBD报文中，两端口必须一致
6. 掩码，如12.1.1.1/30——12.1.1.2/24 这种情况是可以ping通的，但邻居关系起不来
   （OSPF对环回口，无论掩码多少位，都按32位处理，所以建议环回口直接/32，或者在环回口下还原真实掩码）
7. ACL（是否放行OSPF）



<img src="D:\Picture\Typora\华为网络\OSPF.png" style="zoom:200%;" />





### OSPF更新

1. OSPF是一种触发更新的机制。一旦拓扑发生变化便会更新。
2. OSPF也有周期性更新（==30分钟一次==）
3. 当收到一条LSA之后：
   首先查看是否在LSDB中，若没有则假如LSDB，回复LSACK。继续泛洪出去，并且通过SPF算法计算最佳路径并加入路由表。若存在，则比较谁的更“新”（看序号），序号大者新，若本地不如收到的信更新本地LSDB并泛洪，且通过SPF算法计算最佳路径并加入路由表，若比收到的新，则将本地的泛洪出去。

注：LSA序列号，4字节，16进制
0x80000001-0x7FFFFFFF





### OSPF数据包类型

1. Hello：==10秒==发送一次，死亡时间==40s==，==4倍==关系，可以修改。
2. DBD（Database Description ）：仅仅是一个对本地数据库的概念性叙述，供路由器核对数据库是否同步
3. LSR（Link-State Request，请求链路状态 ）：在数据库同步过程中使用，请求其他角色发送自己失去的LSA最新版本。
4. LSU（Link-State Update 链路状态更新）：LSU包括几种类型的LSA，LSU负责泛洪LSA，和相应LSR。LSA只会发送给之前以LSR请求的LSA的直连邻居，进行泛洪的时候，邻居路由负责把收到的LSA信息重新封装在新的LSU中。
5. LSACK：链路状态确认，路由器必须对每个收到的LSA进行LSACK确认，但可以用一个LSACK确认多个LSA。





### DR、BDR的选举

DR、BDR的选举规则：**比较router-id**，router-id有以下获得方式：

1. 由工程师指定
2. 这台设备最大的环回口IP
3. 没有环回口的话，物理接口IP地址最大的。

选举规则：

1. 最高优先级值的路由器被选为DR（默认优先级相同：1），次高优先级的为BDR
2. 若优先级相同，则比较router-id，拥有最高router-id的成为DR，次高的成为BDR
3. 优先级被设置为0的不参与选举
4. OSPF系统启动后，若40s内没有新设备接入就会开始选举，所以为保证DR与BDR的选举不发生意外，建议优先配置想成为DR与BDR的设备。
5. DR与BDR不可以抢占
6. 当DR消失之后，BDR直升DR，重新选BDR
7. 所有DR，BDR，DRothers说的都是==接口==，***而不是设备***
8. ==不同网段间选DR，BDR==，而不是以OSPF区域为单位





### OSPF状态

1. Down State
2. Init State：发送了Hello包（还没收到）
3. Two-way State：收到了一个Hello包且Hello包中包括自己的router-id（对方回复的）
4. Exstart State：First DBD确认主从关系，router-id大的为主，先发包
5. Exchange State：交互DBD 相互学习
6. Loading State：LSR与LSU的交互过程
7. Full State：所有交互已经完成

注：DBD只是一个目录的性质，并且第一个DBD只是用来协商之后的DBD由谁先发送。



### 支持的网络类型

* 指OSPF能够支持的二层网络类型
* 有这几种：
  1. 广播网络
  2. NBMA网络
  3. 点到点网络
  4. 点到多点网络
* 注意：OSPF路由器的某个接口的类型，跟该接口直接相连的二层网络类型一致。比如，某个接口连接的是广播网络，那么该接口就是广播网络接口。





### OSPF配置命令

~~~

~~~





# ★第九章VLAN三层通信



* VLAN是工作在二层的，如果要让VLAN之间通信我们要使用一些三层的设备，例如：路由器、三层交换机等
* 多臂路由：由路由器多个接口提供VLAN间通信的方案
* 单臂路由：相对于多臂路由方案**可以节省企业购买路由器接口的资金**；但是，单臂路由由于所有数据都在同一个接口上传输，随着VLAN数量的增加将会**增大这条链路的带宽压力**；同时这条链路也成为了企业网络的**单点故障**，一旦出现问题则整个网络都无法通信
* 三层交换：通过三层交换机的**Vlanif接口实现了三层数据通信**；相比单臂路由方案，三层交换更具有扩展性，即使VLAN增加也不会对其性能造成很大影响。；在VLAN间通信占企业大部分流量的网络中能够很好的承担服务压力
* VLAN聚合：相比三层交换方案，VLAN聚合方案能够**实现不同VLAN都使用相同的网关通信的功能**，有效的减少IP地址的浪费和提高管理效率；但相对的，相同网段的计算机之间互访都依靠同一个Vlanif接口，也使这个接口的压力增大



### 通过多臂路由实现VLAN间的三层通信

* 由路由器两个接口提供VLAN间通信的方案就是多臂路由
* 路由器可以处理不带tag的数据包，正好access链路传输的是不带tag的数据



<img src="D:\Picture\Typora\华为网络\多臂路由.png" style="zoom:200%;" />





~~~
[SW1]int g0/0/2
[SW1-GigabitEthernet0/0/2]port link-type access
 [SW1-GigabitEthernet0/0/2]port default vlan 2
[SW1-GigabitEthernet0/0/2]int g0/0/1
[SW1-GigabitEthernet0/0/1] port link-type access
[SW1-GigabitEthernet0/0/1] port default vlan 2


[SW2]int g0/0/1
[SW2-GigabitEthernet0/0/1]interface GigabitEthernet0/0/1
[SW2-GigabitEthernet0/0/1] port link-type access
[SW2-GigabitEthernet0/0/1] port default vlan 3
[SW2-GigabitEthernet0/0/1]int g0/0/2
[SW2-GigabitEthernet0/0/2]port link-type access
[SW2-GigabitEthernet0/0/2] port default vlan 3

[r1]interface e0/0/0
[r1-ethernet0/0/0]ip address 10.0.2.254 24
[r1]interface e0/0/2
[r1-ethernet0/0/2]ip address 10.0.3.254 24

~~~



### 通过单臂路由实现VLAN间的三层通信



* 原理：

  通过一台路由器，在他的物理接口上配置*子接口*实现一当多。路由器同一接口的不同子接口作为不同VLAN的默认网关。当不同VLAN间通信时，将数据包发送给网关，网关处理后在发送至目的主机所在VLAN。

* **路由器只需一个端口和交换机进行连接，并设置该端口的子端口对应的vlan信息，而交换机只需将连接路由器的端口设置vlan模式为trunk即可。**





<img src="D:\Picture\Typora\华为网络\单臂路由实现不同VLAN通信.png" style="zoom:200%;" />

过程：

1. 把pc1、pc2、pc3划分到对应的vlan10、vlan20、vlan30
2. 设置与之相连的交换机接口的端口类型Access口，同时把这个口划分到对应的VLAN中。
3. 再把交换机和交换机连接的口设置成Trunk口，并且允许所有VLAN通过
4. 在R１上创建三个子接口，把每个子接口作为每个vlan的网关（１９２.１６８.１.２５４等等）
5. 最后配置路由器子接口封装vlan，让路由器能够识别和处理valn标签的数据包

```
以S2为例创建vlan以及接口划分
[s2]vlan 10
[s2-vlan10]vlan 20
[s2-vlan20]interface E0/0/1
[s2-ethernet0/0/1]port link-type access
[s2-ethernet0/0/1]port default vlan 10
[s2-ethernet0/0/1]interface e0/0/2
[s2-ethernet0/0/2]port link-type access
[s2-ethernet0/0/2]port default vlan 20
[s2-ethernet0/0/2]interface Ge0/0/2
[s2-ge0/0/2]port link-type trunk
下面连接了vlan10和vlan20，所以这里出去的要设置所有vlan的通过
[s2-ge0/0/2]port trunk allow-pass vlan all

[s3]vlan30
[s3-vlan30]interface e0/0/1
[s3-ethernet0/0/1]port link-type access
[s3-ethernet0/0/1]prot default vlan 30
[s3-ethernet0/0/1]interface ge0/0/2
[s3-ge0/0/2]port link-type trunk
下面连接了vlan10和vlan20，所以这里出去的要设置所有vlan的通过
[s3-ge0/0/2]port trunk allow-pass vlan all

[s1]在s1上划出三个vlan，并且他的三个就扣全是trunk类型，允许所有vlan通过

配置路由器
[r1]interface g0/0/1.1
[r1-ge0/0/1.1]ip address 192.168.1.254  24
[r1-ge0/0/1.1]interface ge0/0/1.2
[r1-ge0/0/1.2]ip address 192.168.2.254 24
[r1-ge0/0/1.2]interface ge0/0/1.3
[r1-ge0/0/1.3]ip address 192.168.3.254 24
配置子接口可以封装vlan，开启arp向外转发
[r1-ge0/0/1.3]dot1q termination vid
[r1-ge0/0/1.3]arp broadcast enable
[r1-ge0/0/1.3]interface ge0/0/1.2
[r1-ge0/0/1.2]dot1q termination vid
[r1-ge0/0/1.2]arp broadcast enable
[r1-ge0/0/1.2]interface ge0/0/1.1
[r1-ge0/0/1.1]dot1q termination vid
[r1-ge0/0/1.1]arp broadcast enable
[r1-ge0/0/1.1]
到这里就配置完成，可以实现通信了。
```



### 通过三层交换机实现VLAN间的三层通信



![](D:\Picture\Typora\华为网络\三层交换机.png)



~~~
pc1		192.168.1.1  24  192.168.1.254
pc2		192.168.1.2  24  192.168.1.254
pc3		192.168.2.1  24  192.168.2.254
S1 		
		VLANIF192.168.1.254  24  
		VLANIF192.168.1.254  24  
		
[s1]interace vlanif 10
[s1-vlanif10]ip address 192.168.1.254 24
[s1-vlanif10]interace vlanif 20
[s1-vlanif20]ip address 192.168.2.254 24

就结束了。
查看接口状态
【S1】display IP interface brief
~~~



### VLAN接口配置案例









# 第十章链路技术



大概就是多增加一条或者几条链路。

* 标准以太网端口（Ethernet）		10Mbit / s    （发送速率）

  快速以太网端口 （Fast Ethernet） 		100Mbit / s

  千兆以太网端口（或者GE口，Gigabit Ethernet）			1000M/s

  万兆以太网端口（万兆口，10GE口）			10Gbit /s

  100G端口											100Gbit / s

* 利用链路技术，可以：
  1. 根据需要灵活增加网络设备之间的带宽供给。
  2. 增强网络设备之间的连接可靠性
  3. 节约成本
  
* 链路聚合技术应用在：

  1. 交换机和路由器之间
  2. 交换机和交换机之间
  3. 路由器和路由器之间
  4. 交换机和服务器之间
  5. 路由器和服务器之间
  6. 服务器和服务器之间

* 















# 第十一章DHCP及网络地址转换技术



* 前身是BOOTP协议，DHCP可以兼容它。

* Dynamic Host Configuration Protocol，动态主机配置协议。

* 是一种C/S 模式的网络协议 。

* 应用层协议

* 主要作用是集中的管理、分配IP地址，使网络环境中的主机动态的获得IP地址、Gateway地址、DNS服务器地址等信息，并能够提升地址的使用率。

  DHCP协议采用客户端/服务器模型，主机地址的动态分配任务由网络主机驱动。当DHCP服务器接收到来自网络主机申请地址的信息时，才会向网络主机发送相关的地址配置等信息，以实现网络主机地址信息的动态配置。



## DHCP基本工作流程



<img src="D:\Picture\Typora\华为网络\DHCP基本工作流程.png" style="zoom:200%;" />



1. 发现阶段

2. 提供阶段

3. 请求阶段

4. 确认阶段

   



## DHCP Server配置案例

~~~
打开dhcp功能
【R1】dhcp enable

创建地址池
【R1】ip pool department1（地址池的名称）
【R1-ip-pool-department1】

配置地址池中可以参与分配的IP地址段
【R1-ip-pool-department1】network 192.168.1.1  mask（掩码长度） 26

配置分配给网关的IP地址
【R1-ip-pool-department1】gateway-list 192.168.1.1
配置之后，系统自动保留该地址，不在分配出去

配置IP地址的租约期
【R1-ip-pool-department1】 lease day 0 hour 1
默认情况下是1天，这里是一个小时



~~~





## DHCP中继代理配置

~~~
【R1】interface GE0/0/0
【R1-interface-GE0/0/0】ip address 192.168.1.1 26(给端口配IP)

使能DHCP中继代理功能
【R1-interface-GE0/0/0】dhcp select relay


查看DHCP相关的中继配置
【R1-interface-GE0/0/0】display this
~~~





## 网络地址转换技术（NAT）



* 基本作用：实现私网ip地址与公网IP地址之间的转换。

* ABC类中的私网IP地址

  1. 10.0.0.0—–10.255.255.255

  2. 172.16.0.0—–172.31.255.255

  3. 192.168.0.0—–192.168.255.255

  4. 注意：除了私网IP地址之外，IP地址空间里的其他地址都是公网IP地址

     ​			公网绝对不能使用私网IP。





## 静态NAT



* 核心： 建立并维护一张静态地址映射表





## 动态NAT

*  动态NAT是在路由器上配置一个外网IP地址池（共有IP地址资源池），当内部有计算机需要和外部通信时，就从地址池里动态的取出一个外网IP，并将他们的对应关系绑定到NAT表（动态地址映射表）中，通信结束后，这个外网IP才被释放，可供其他内部IP地址转换使用，这个DHCP租约IP有相似之处。



包含一个共有IP地址资源池和一张动态地址映射表。

<img src="D:\Picture\Typora\华为网络\动态NAT.png" style="zoom:200%;" />





## NAPT



*  这是最常用的NAT技术，也是IPv4能够维持到今天的最重要的原因之一，它提供了一种多对一的方式，对多个内网IP地址，边界路由可以给他们分配一个外网IP，利用这个外网IP的不同端口和外部进行通信。



<img src="D:\Picture\Typora\华为网络\NAPT.png" style="zoom:200%;" />





## 静态NAT配置案例

~~~
【R1】interface GE0/0/0

将公网IP地址global-address与私网IP地址host-address进行绑定
【R1-interface-GE0/0/0】nat static global 202.10.1.3（公网） inside 192.168.0.2（私网）

查看
《R1》 display nat static
~~~





# 第十二章PPP与PPPoe



* PPP： 点到点协议，和以太网协议一样，是数据链路层协议

* 前身是SLIP和CSLIP，这两种协议已经不再使用。

* PPP是为了在点对点物理链路(例如RS232串口链路、电话ISDN线路等)上传输OSI模型中的网络层报文而设计的，它改进了之前的一个点对点协议-SLIP协议–只能同时运行一个网络协议、无容错控制、无授权等许多缺陷，PPP是现在最流行的点对点链路控制协议。这种连接提供了同时的双向的全双工操作，并且假定数据包是按顺序投递的。PPP连接提供了一种广泛的解决办法，方便地将多种多样不同的值作为最大接收单元的值。

* PPP协议功能

  

  (1) 简单：在同一条物理链路上进行点对点的数据传输，对数据链路层的帧不进行纠错，不需要序号，不需要流量控制。

  (2) 封装成帧：加入帧界定符。

  (3) 透明性：字节填充法。

  (4) 多种网络层协议：在同一条物理链路上同时支持多种网络层协议（如IP和IPX等）的运行。

  (5) 多种链路类型：PPP必须能够在多种类型的链路上运行，例如串行或并行链路。

  (6) 差错检测：接收方收到一个帧后进行CRC检验，若正确就收下这个帧，反之则丢弃。

  (7) 检测连接状态：自动检测链路是否处于正常工作状态。

   



## PPP之认证阶段



* 两种认证方式：PAP,CHAP
  PAP（Password Authentication Protocol）用户名和密码使用明文传输，安全性低。
  CHAP（Challenge Handshake Authentication Protocol）用户名和密码使用密文传输，安全性较高。



## PPP基本配置

~~~
【R1】interface Ethernet 0/0/0

将当前接口的链路层协议配置为PPP
【R1-Ethernet-0/0/0】 link-protocol ppp

R1给R2分配一个IP地址
【R1-Ethernet-0/0/0】remote address 10.0.0.2
[R2]interfac Ethernet 0/0/0
希望对接口分配一个IP地址给自己
[R2-Ethernet-0/0/0]ip address ppp-negotiate

验证
【R2】display interface Ethernet0/0/0
~~~





## PPPoe协议概念

* （英语：Point-to-Point Protocol Over Ethernet），[以太网](https://baike.baidu.com/item/以太网)上的点对点协议，是将[点对点协议](https://baike.baidu.com/item/点对点协议)（PPP）封装在[以太网](https://baike.baidu.com/item/以太网)（Ethernet）框架中的一种网络隧道协议。由于协议中集成PPP协议，所以实现出传统[以太网](https://baike.baidu.com/item/以太网)不能提供的[身份验证](https://baike.baidu.com/item/身份验证)、[加密](https://baike.baidu.com/item/加密)以及[压缩](https://baike.baidu.com/item/压缩)等功能，也可用于缆线调制解调器（cable modem）和[数字用户线路](https://baike.baidu.com/item/数字用户线路)（DSL）等以[以太网](https://baike.baidu.com/item/以太网)协议向用户提供接入服务的协议体系。

  本质上，它是一个允许在以太网[广播域](https://baike.baidu.com/item/广播域)中的两个以太网接口间创建点对点隧道的协议。

* PPPoE是一个二层协议，用于把PPP的数据帧封装在以太网帧中。借助PPP的优势，可以很好地实现认证、会话检测、计费等，主要用于运营商及小区宽带。

* ***\*PPPoE基本原理：\****

  PPPoE分为控制层面和数据层面，控制层面就是如何建立PPPoE会话，如何进行用户的认证，而数据层面就是我们数据包的转发。PPPoE在控制层面分为两个阶段，第一阶段是Discovery（发现）阶段，第二阶段是会话建立阶段。









# 第十三章网络安全与网络管理



## 访问控制列表（ACL）



* 定义

  访问控制列表ACL（Access Control List）是由一系列规则组成的集合，ACL通过这些规则对报文进行分类，从而使设备可以对不同类报文进行不同的处理。

* ACL的基本原理

  ACL负责管理用户配置的所有规则，并提供报文匹配规则的算法。

* 类型（引用最广泛的是基本和高级）：

  1. 基本ACL
  2. 高级ACL
  3. 二层ACL
  4. 用户自定义ACL

* 标准ACL 的编号范围：   0—1999

  用户自定义的ACL，一一跟上面类型对应：

  ​		2000-2999

  ​		3000-3999

  ​		4000-4999

  ​		5000-5999

~~~
创建一个编号2000的acl，然后这个视图下创建如下规则
【R1】acl 2000
【R1-acl-basic-2000】rule deny source 172.16.10.100 0.0.0.0
（拒绝IP地址172.16.10.100的IP报文；permit是允许，只需要将deny改成这个就行）

拒绝吗，目的地址为172.16.10.100的IP报文
【R1-acl-adv-3000】rule deny destination 172.16.10.100 0.0.0.0

用报文过滤技术将acl3000应用在R的GE/0/0/3接口的路方向上
【R-GigabitEthernet0/0/3】 traffic-filter inbound acl 3000
~~~





## SMI（管理信息结构）



* SMIv1版本就记住前两个1155，1212就行
  1515定义内容
  1212改进

![](D:\Picture\Typora\华为网络\SMI.png)





## MIB（管理信息库）



* MIB使用OID来识别的
  每个设备都会有一个mib
* mib就是一个树形图，其中是没有值的，值可以存放在数据库中被修改调用

<img src="D:\Picture\Typora\华为网络\MIB .png" style="zoom:200%;" />





## SNMP（简单网络管理协议）



* 也是一种**c/s **模式的网络协议。
* 主动的就是client，被动的就是server





<img src="D:\Picture\Typora\华为网络\SNMP.png" style="zoom:200%;" />



# 补充知识及常识



## 协议对应端口号

- 0 - 1023: 知名端口号, HTTP, FTP, SSH等这些广为使用的应用层协议, 他们的端口号都是固定的.
- 1024 - 65535: 操作系统动态分配的端口号. 客户端程序的端口号, 就是由操作系统从这个范围分配的.



~~~

ssh服务器, 使用22端口
ftp服务器, 使用21端口
ftp客户端		TCP2000
telnet服务器, 使用23端口
http服务器, 使用80端口
https服务器, 使用443
SMTP服务器    tcp25
talnet      23
TFTP（简单文件传输协议）     69

~~~





## 集线器



~~~
**集线器**（Hub）是指将多条以太网双绞线或光纤集合连接在同一段物理介质下的设备。集线器是运作在OSI模型中的物理层。它可以视作多端口的中继器，若它侦测到碰撞，它会提交阻塞信号。

由于集线器会把收到的任何数字信号，经过再生或放大，再从集线器的所有端口提交，这会造成信号之间碰撞的机会很大，而且信号也可能被窃听，并且这代表所有连到集线器的设备，都是属于同一个碰撞域名以及广播域名，因此大部份集线器已被交换机取代。
~~~



## 网关



* 网关是将两个使用不同传输协议的网络段连接在一起的设备，网关一般用作网络的入口和出口点，因为所有数据必须在路由之前通过或与网关通信。在大多数基于IP的网络中，唯一不通过至少一个网关的流量是在同一局域网（LAN）段上的节点之间流动的流量。
* 就是将两个使用不同协议的网络段连接在一起的设备。它的作用就是对两 个网络段中的使用不同传输协议的数据进行互相的翻译转换。





# 实验



## 1.4配置通过telnet登录系统

在路由器上配置(也可以在交换机里面配置)

~~~

[R1]user-interface vty 0 4
[R1-ui-vty0-4]authentication-mode password
然后输入密码就行

Quidway]user-interface vty 0 4                               ；进入虚拟终端
[S3026-ui-vty0-4]authentication-mode password                 ；设置口令模式
[S3026-ui-vty0-4]set authentication-mode password simple 222  ；设置口令
[S3026-ui-vty0-4]user privilege level 3   
一、第一句的意思是：进入到vty 终端，在华为的交换机里，vty就是人家用telnet远程进入到你交换机的界面，最多有五个，所以说你可以vty 0   vty 1  vty... vty 4交换机最多可以允许五个人同时在线进到交换机里去配置命令的。vty0 4 就是说把这五个界面一起配置了，这五个界面进去的话，都是使用以下的配置。
二、用的认证模式是密码认证，可以使用scheme模式来，也可以用password来，用password的话，是要密码的，就是说你telnet的话，要输入密码才能登陆到包交换机里去的。
二、设置密码为明文密码，密码是123 ，如果是密文的话，就是cipher
四、用户等级为3，也就是最高的，华为的命令级别很多，分为四级，0 1 2 3  ，0是参观级，只能看，1比0要高，可以使用一些命令，2 是可以配置了，3可以备份与删除IOS啦，呵呵，这个命令就是说用这个123密码，进来就是最高级别的，不用换级别。
~~~





## 1.6配置通过FTP进行文件操作



~~~
//连接ftp服务器
<R1>ftp 10.0.2.1
//get下载到本地路由器
[R1]get test.txt
//上传到ftp服务器
[R1]put test.txt

~~~





## 2.2理解ARP及proxy ARP

* ARP：讲IP地址映射到正确的MAC地址。

* proxy ARP（代理ARP）就是通过使用一个主机(通常为router),来作为指定的设备对另一设备作出ARP请求的应答。



~~~
配置静态ARP
[R1]arp static 10.1.1.1 5463-893C-4222

开启arp代理
[R1]interface GE0/0/1
[R1-GE0/0/1]arp-proxy enable
开启了路由器一端接口的代理ARP后，另一端接口的也要开启不然，两端的网段还是不能通信，
[R1]interface GE0/0/2
[R1-GE0/0/2]arp-proxy enable

~~~





## 3.2配置trunk口



trunk：交换机之间的端口

~~~
vlan 10创建vlan10

[S1]vlan 10

~~~

